# A2A Protocol Documentation - Official Specification v0.2.2

## Review

This Postman collection implements the full specification of Google's Agent2Agent (A2A) Protocol v0.2.2, an open standard for inter-agent communication and collaboration between independent AI agents.

## About the A2A protocol

**Agent2Agent (A2A)** - это открытый протокол, разработанный для облегчения коммуникации и взаимодействия между независимыми, потенциально закрытыми системами AI агентов. В экосистеме, где агенты могут быть построены с использованием различных фреймворков, языков или разными поставщиками, A2A предоставляет общий язык и модель взаимодействия.

### Key Goals of A2A

- **Communication**: Bridging the communication gap between heterogeneous agent systems
- **Collaboration**: Agents can delegate tasks, share context, and collaborate on complex user requests
- **Discovery**: Dynamically discover and understand the capabilities of other agents
- **Flexibility**: Support for various interaction modes
- **Security**: Secure communication patterns for enterprise environments
- **Async**: Native support for long-running tasks and interactions

## Protocol Architecture

### Transport and Format

- **Transport Protocol**: HTTP(S) - mandatory for production environments
- **Data Format**: JSON-RPC 2.0 for all requests and responses
- **Streaming**: Server-Sent Events (SSE) for real-time updates
- **Content-Type**: `application/json` for JSON-RPC, `text/event-stream` for SSE

### Key Components

#### 1. Agent Card
A JSON metadata document describing:
- Agent identity and capabilities
- Service endpoint URL
- Authentication requirements
- Supported skills and modalities

Typically available at /.well-known/agent.json

#### 2. Task
The fundamental unit of work in A2A:
- Unique ID generated by the server
- State lifecycle
- Message history
- Artifacts (results)

#### 3. Message
A single communication turn:
- Role: "user" or "agent"
- Parts with content
- Metadata and extensions

#### 4. Part
An elementary unit of content:
- **TextPart**: Text content
- **FilePart**: File content (base64 or URI)
- **DataPart**: Structured JSON data

#### 5. Artifact
Result of the agent's execution:
- Immutable output data
- Composed of one or more parts
- Can be transmitted incrementally

`## Collection Settings

### Collection Variables

Set the following variables in Postman:

| Variable | Description | Example |
|------------|----------|---------|
| `baseUrl` | A2A server base URL | `https://localhost:10004` |
| `authToken` | Authentication token | `eyJhbGciOiJIUzI1NiIs...` |
| `taskId` | Task ID for operations | `task-uuid` |

### Authentication

A2A supports standard authentication schemes:
- **Bearer Token**: OAuth 2.0 tokens
- **API Key**: Static API keys
- **Basic Auth**: Basic authentication
- **OpenID Connect**: OIDC tokens

Authentication schemes are declared in the Agent Card in the `securitySchemes` field.
`
## Using the Collection

### 1. Discovering Agents

#### Obtaining a Public Agent Card
```http
GET /.well-known/agent.json
```

Returns agent metadata, including:
- Capabilities
- Skills
- Security Schemes
- Supported Modalities

#### Getting an extended Agent Card (authenticated)
```http
GET /agent/authenticatedExtendedCard
Authorization: Bearer {token}
```

Available only if `supportsAuthenticatedExtendedCard: true`.

### 2. Message Operations

#### Sending a Message (No Streaming)
```json
{
  "jsonrpc": "2.0",
  "id": "uuid",
  "method": "message/send",
  "params": {
    "message": {
      "role": "user",
      "parts": [
        {
          "kind": "text",
          "text": "Hi! Tell me a joke."
        }
      ],
      "messageId": "uuid",
      "kind": "message"
    },
    "configuration": {
      "acceptedOutputModes": ["text/plain", "application/json"],
      "historyLength": 5,
      "blocking": true
    }
  }
}
```

#### Sending a Streaming Message (SSE)
```json
{
  "jsonrpc": "2.0", 
  "id": "uuid",
  "method": "message/stream",
  "params": {
    "message": {
      "role": "user",
      "parts": [
        {
          "kind": "text",
          "text": "Write a long article about AI."
        }
      ],
      "messageId": "uuid",
      "kind": "message"
    }
  }
}
```

Ответ: `Content-Type: text/event-stream` с потоком SSE событий.

### 3. Управление задачами

#### Получение статуса задачи
```json
{
  "jsonrpc": "2.0",
  "id": "uuid", 
  "method": "tasks/get",
  "params": {
    "id": "task-id",
    "historyLength": 10
  }
}
```

#### Cancel task
```json
{
  "jsonrpc": "2.0",
  "id": "uuid",
  "method": "tasks/cancel", 
  "params": {
    "id": "task-id"
  }
}
```

#### Resubscribing to a task stream
```json
{
  "jsonrpc": "2.0",
  "id": "uuid",
  "method": "tasks/resubscribe",
  "params": {
    "id": "task-id"
  }
}
```

### 4. Push Notifications

#### Setting up push notifications
```json
{
  "jsonrpc": "2.0",
  "id": "uuid",
  "method": "tasks/pushNotificationConfig/set",
  "params": {
    "taskId": "task-id",
    "pushNotificationConfig": {
      "url": "https://client.example.com/webhook/a2a-notifications",
      "token": "secure-client-token",
      "authentication": {
        "schemes": ["Bearer"]
      }
    }
  }
}
```

#### Getting push notification configuration
```json
{
  "jsonrpc": "2.0",
  "id": "uuid", 
  "method": "tasks/pushNotificationConfig/get",
  "params": {
    "id": "task-id"
  }
}
```
## Task Lifecycle

### Task States

| State | Description | Terminal |
|-----------|-------------|-------------|
| `submitted` | Task received and confirmed | No |
| `working` | Task is actively being processed | No |
| `input-required` | Additional input required | No (pause) |
| `auth-required` | Additional authentication required | No (pause) |
| `completed` | Task completed successfully | Yes |
| `failed` | Task completed with an error | Yes |
| `canceled` | Task canceled | Yes |
| `rejected` | Task rejected by agent | Yes |
| `unknown` | Undefined state | Yes |

### Typical Flow

1. **Discovery**: Client receives an Agent Card
2. **Initiation**: Sending `message/send` or `message/stream`
3. **Processing**: Agent processes the task
4. **Interaction**: Optionally a multi-step dialogue
5. **Completion**: Reaching a terminal state

## Usage Examples

### Simple Request
```http
POST /
Content-Type: application/json

{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "message/send", 
  "params": {
    "message": {
      "role": "user",
      "parts": [{"kind": "text", "text": "Tell a joke"}],
      "messageId": "uuid",
      "kind": "message"
    }
  }
}
```

### Sending a file
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "message/send",
  "params": {
    "message": {
      "role": "user", 
      "parts": [
        {
          "kind": "text",
          "text": "Analyze this image"
        },
        {
          "kind": "file",
          "file": {
            "name": "image.png",
            "mimeType": "image/png", 
            "bytes": "base64-encoded-data"
          }
        }
      ],
      "messageId": "uuid",
      "kind": "message"
    }
  }
}
```

### Multi-stage interaction
```json
// Step 1: Initial Request
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "message/send",
  "params": {
    "message": {
      "role": "user",
      "parts": [{"kind": "text", "text": "Book a flight"}],
      "messageId": "uuid1",
      "kind": "message"
    }
  }
}

// Ответ: state: "input-required"

// Step 2: Providing Details
{
  "jsonrpc": "2.0", 
  "id": 2,
  "method": "message/send",
  "params": {
    "message": {
      "role": "user",
      "parts": [{"kind": "text", "text": "Moscow-London, October 10-17"}],
      "contextId": "context-id",
      "taskId": "task-id", 
      "messageId": "uuid2",
      "kind": "message"
    }
  }
}
```
## Error Handling

### Standard JSON-RPC Errors

| Code | Description |
|-----|---------|
| -32700 | Parse error - Invalid JSON |
| -32600 | Invalid Request - Invalid JSON-RPC request |
| -32601 | Method not found - Method not found |
| -32602 | Invalid params - Invalid parameters |
| -32603 | Internal error - Internal server error |

### A2A-specific errors

| Code | Error | Description |
|-----|---------|---------|
| -32001 | TaskNotFoundError | Task not found |
| -32002 | TaskNotCancelableError | The task cannot be canceled |
| -32003 | PushNotificationNotSupportedError | Push notifications are not supported |
| -32004 | UnsupportedOperationError | Operation not supported |
| -32005 | ContentTypeNotSupportedError | Content type not supported |
| -32006 | InvalidAgentResponseError | Invalid agent response |

## Advanced Features

### Streaming (SSE)

For long-running tasks, use `message/stream`:
- Receive `TaskStatusUpdateEvent` events
- Receive `TaskArtifactUpdateEvent` events
- Handle incremental updates

### Push Notifications

For disabled or background scenarios:
- Configure a webhook URL
- Receive asynchronous updates
- Authenticate incoming notifications

### Multimodality

A2A supports the exchange of various content types:
- Text (TextPart)
- Files (FilePart) - inline base64 or URI
- Structured data (DataPart)
- Future audio/video support

## Security

### Security Recommendations

1. **Always use HTTPS** in production environments
2. **Verify TLS certificates** of remote agents
3. **Use Modern authentication schemes** (OAuth 2.0, JWT)
4. **Validate incoming data** and metadata
5. **Enforce the principle of least privilege**
6. **Log and monitor** inter-agent interactions

### Credential Management

- Obtain credentials **outside** the A2A protocol
- Pass tokens via HTTP headers
- Do not include secrets in Agent Cards
- Use dynamic tokens where possible

## Testing

### Core Tests

This collection includes automated tests for:
- Validating response status codes
- Validating the JSON-RPC structure
- Extracting taskId from responses
- Error handling

### Test Scenarios

1. **Agent Discovery** - Obtaining Agent Cards
2. **Core Messages** - Text requests and responses
3. **Multimodality** - Files and Structured Data
4. **Task Management** - Task Lifecycle
5. **Error Handling** - Various Error Scenarios

## Troubleshooting

### Common Issues

**Error 401/403**: Check authentication tokens and security schemes in the Agent Card

**Error 404**: Make sure the baseUrl is correct and the agent is running

**Error -32601**: Method not supported - check capabilities in the Agent Card

**Error -32001**: Task not found - check taskId or create a new task

**Streaming Timeout**: Check streaming support in capabilities

### Debugging

1. **Check the Agent Card** for supported methods
2. **Validate the JSON-RPC** request structure
3. **Monitor the logs** for detailed error messages
4. **Test authentication** Separate from business logic

## References

- **Official Specification**: https://google-a2a.github.io/A2A/latest/specification/
- **GitHub Repository**: https://github.com/google-a2a/A2A
- **Key Concepts**: https://google-a2a.github.io/A2A/topics/key-concepts/
- **Developer Guide**: https://google-a2a.github.io/A2A/topics/
- **Integration Examples**: https://github.com/google-a2a/A2A/tree/main/samples

---

This collection provides a complete implementation of the A2A v0.2.2 specification for testing and integration with A2A-compliant agents. Use it as a starting point for developing your own multi-agent solutions.